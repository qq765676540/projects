<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <!-- <meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"> -->
  <!-- <meta name="viewport" content="width=device-width,initial-scale=1.0 ,minimum-scale=1.0,maximum-scale=2.0,user-scalable=yes"/> -->
  <meta name="viewport" content="width=device-width, maximum-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>.</title>
  <link rel="icon" href="../staticFiles/favicon/ico.png" type="image/x-icon" />
  <link rel="stylesheet" href="./css/common.css" />
  <link rel="stylesheet" href="./font/iconfont.css" />
  <link rel="stylesheet" href="./css/mobile.css" />
  <link rel="stylesheet" href="./css/login.css" />
</head>

<body>
  <div class="login-page">
    <img src="./img/GST-logo.png" class="login-logo" />
    <div class="login-form">
      <div class="login-line">
        <img src="./img/user.png" />
        <input id="Username" placeholder="username" />
      </div>
      <div class="login-line">
        <img src="./img/password.png" />
        <input id="Password" type="password" placeholder="password" />
      </div>
      <div class="login-line">
        <p id="login-btn">登录</p>
      </div>
    </div>
  </div>
</body>
<script type="text/javascript" src="./js/jquery-2.2.3.js"></script>
<script type="text/javascript" src="./js/common.js"></script>

<script>
  $(function () {
    var basicUrl = "/portalbasicapi";
    $("#login-btn").on("click", function () {
      var emailVal = $("#Username").val();
      var passwordVal = $("#Password").val();
      if (!emailVal) {
        alert("用户名不能为空");
        return;
      }
      if (!passwordVal) {
        alert("密码不能为空");
        return;
      }
      var params = {
        email: emailVal,
        password: window.btoa(passwordVal),
        returnUrl: "",
        language: "zh"
      };
      var dataAddress = "/Access/Login";
      $.ajax({
        type: "post",
        url: basicUrl + dataAddress,
        dataType: "json",
        contentType: "application/json;charset=utf-8",
        data: JSON.stringify(params),
        success: function (res) {
          if (res && res.data.isSuccess) {
            let token = res.data.tokenAccess;
            let code = res.data.code;
            window.location = window.location.protocol + '//' + window.location.hostname + '/mobile/index.html?id_token=' + token;
          }
        },
        error: function (err) {
          alert("登录失败" + JSON.stringify(err));
        }
      });
    });
  })
</script>
</html>